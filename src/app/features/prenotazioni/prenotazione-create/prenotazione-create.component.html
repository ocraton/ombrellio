<h2 id="titleCreatePrenotazioniModal">
  Prenota l'ombrellone
  <span style="color: #673ab7; font-weight: 600">{{
    data.ombrellone.numero
    }}</span>
  |
  <span class="subTitleCreatePrenotazioniModal"
    *ngIf="data.rangeDate.dataInizio.getTime() < data.rangeDate.dataFine.getTime(); else dataInizioFinediverse">
    Dal: <b>{{ data.rangeDate.dataInizio | date: "dd/MM/yyyy" }}</b> Al:
    <b>{{ data.rangeDate.dataFine | date: "dd/MM/yyyy" }}</b></span>
  <ng-template #dataInizioFinediverse>
    <span class="subTitleCreatePrenotazioniModal">
      Il giorno: <b>{{ data.rangeDate.dataInizio | date: "dd-MM-yyyy" }}</b>
    </span>
  </ng-template>
</h2>

<mat-divider></mat-divider>

<ng-template #clientePrenSelected>
  <mat-card>
    <mat-card-title>Riepilogo </mat-card-title>
    <mat-card-content>
      <mat-list>
        <mat-list-item>
          <span style="font-weight: 600; font-size: 1.3rem; color: #673ab7">
            {{ clientePren.nome }} {{ clientePren.cognome }} &nbsp;&nbsp; </span>
          <span> <b>Email:</b> {{ clientePren.email }} | <b>Telefono:</b>
            {{ clientePren.telefono }}
          </span>
        </mat-list-item>
        <mat-divider></mat-divider>
        <mat-list-item *ngIf="attrezzatureArray.length > 0">
          <b>Attrezzature:&nbsp;&nbsp;</b> <span *ngFor="let attrezzatura of attrezzatureArray; let i = index">
            {{ attrezzatura.nome }}: {{ attrezzatura.quantita }} &nbsp; </span>
        </mat-list-item>
        <mat-divider *ngIf="attrezzatureArray.length > 0"></mat-divider>
        <mat-list-item>
            <b>Pagato: &nbsp;</b>
            <span *ngIf="isPagato; else nopagato"> SI </span>
            <ng-template #nopagato> NO </ng-template>
            &nbsp;&nbsp;
            <span *ngIf="pagamentiForm.get('accontoForm').value > 0"> <b>Acconto:</b> {{ pagamentiForm.get('accontoForm').value }} €</span>
            &nbsp;&nbsp;
            <span *ngIf="pagamentiForm.get('prezzoForm').value > 0"> <b>Prezzo:</b> {{ pagamentiForm.get('prezzoForm').value }} €</span>
        </mat-list-item>
        <mat-divider></mat-divider>
        <mat-list-item *ngIf="pagamentiForm.get('noteForm').value.length > 0">
          <div>
            <b>Note: &nbsp;</b>
            <span *ngIf="pagamentiForm.get('noteForm').value.length > 0"> {{ pagamentiForm.get('noteForm').value }} </span>
          </div>
        </mat-list-item>
        <mat-divider *ngIf="pagamentiForm.get('noteForm').value.length > 0"></mat-divider>
      </mat-list>
    </mat-card-content>
    <mat-card-actions align="end">
      <button mat-raised-button aria-label="seleziona un altro cliente" style="float: right"
        title="seleziona un altro cliente" (click)="removeCliente()">
        Modifica
      </button>
    </mat-card-actions>
  </mat-card>



</ng-template>

<mat-tab-group *ngIf="clientePren == null; else clientePrenSelected">
  <mat-tab label="SELEZIONA CLIENTE">
    <h3>Scegli un cliente</h3>
    <div *ngIf="!(prenotazioniState | async).loadingClienti">
      <mat-form-field style="width: 100%">
        <mat-label>Cerca</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Cerca..." #input />
      </mat-form-field>

      <table mat-table [dataSource]="dataSource" matSort style="width: 100%">
        <ng-container matColumnDef="nome">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Nome</th>
          <td mat-cell *matCellDef="let element">{{ element.nome }}</td>
        </ng-container>
        <ng-container matColumnDef="cognome">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Cognome</th>
          <td mat-cell *matCellDef="let element">{{ element.cognome }}</td>
        </ng-container>
        <ng-container matColumnDef="telefono">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Telefono</th>
          <td mat-cell *matCellDef="let element">{{ element.telefono }}</td>
        </ng-container>
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
          <td mat-cell *matCellDef="let element">{{ element.email }}</td>
        </ng-container>
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef class="action"></th>
          <td mat-cell *matCellDef="let element" class="action">
            <button mat-icon-button color="primary" (click)="selectCliente(element)">
              <mat-icon>check</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
      <mat-paginator #paginator class="mat-elevation-z0" [pageIndex]="0" [pageSize]="5" showFirstLastButtons>
      </mat-paginator>
    </div>
    <div>
      <mat-progress-bar mode="indeterminate" *ngIf="(prenotazioniState | async).loadingClienti"></mat-progress-bar>
    </div>
  </mat-tab>
  <mat-tab label="CREA NUOVO CLIENTE">
    <h3>Crea nuovo cliente</h3>
    <app-prenotazione-cliente-create></app-prenotazione-cliente-create>
  </mat-tab>
  <mat-tab label="ATTREZZATURE">
    <mat-card>
      <mat-card-title style="font-size: 1.2rem;">
        Attrezzature
      </mat-card-title>
      <mat-card-content>
        <div *ngIf="!(prenotazioniState | async).loadingAttrezzature">
          <mat-list role="list">
            <mat-list-item *ngFor="let attrezzatura of (prenotazioniState | async).attrezzature; let i = index"
              role="listitem">
              <div style="width:30%"
                [ngStyle]="attrezzatura.quantita > 0 && { 'font-weight': 'bold', 'color': '#673BB6' }">{{
                attrezzatura.nome }}</div>
              <div>
                <button mat-mini-fab mat-primary
                  [disabled]="attrezzatura.quantita == 0 || attrezzatura.quantita == null"
                  (click)="attrezzaturaAddRemove(attrezzatura, 'remove')" aria-label="aggiungi"
                  class="mat-elevation-z0">
                  <mat-icon>remove</mat-icon>
                </button>
                <input type="text" class="form-control inputAttrezzature" id="valat_{{i}}"
                  [value]="attrezzatura.quantita || 0" readonly>
                <button mat-mini-fab mat-primary (click)="attrezzaturaAddRemove(attrezzatura, 'add')"
                  aria-label="diminuisci" class="mat-elevation-z0">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </mat-list-item>
          </mat-list>
        </div>
        <div>
          <mat-progress-bar mode="indeterminate" *ngIf="(prenotazioniState | async).loadingAttrezzature">
          </mat-progress-bar>
        </div>
      </mat-card-content>
    </mat-card>
  </mat-tab>

  <mat-tab label="PAGAMENTI & NOTE">
    <mat-card>
      <mat-card-title style="font-size: 1.2rem;">
        Pagamenti & Note
      </mat-card-title>
      <mat-card-content>
        <form [formGroup]="pagamentiForm" #formDirective="ngForm" class="form-container">
          <div class="row">
            <div class="column">
              <mat-slide-toggle class="mb20" [checked]="(prenotazioniState | async).isPagato"
                (change)="selectIsPagato($event)">
                Pagato</mat-slide-toggle>
            </div>
            <div class="column">
              <mat-form-field>
                <input matInput type="text" class="form-control" placeholder="Acconto" formControlName="accontoForm">
                <mat-error *ngIf="!pagamentiForm.get('accontoForm').valid && pagamentiForm.get('accontoForm').touched">
                  Inserire un numero con virgola
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="column">
              <mat-form-field>
                <input matInput type="text" class="form-control" placeholder="Prezzo" formControlName="prezzoForm">
                <mat-error *ngIf="!pagamentiForm.get('prezzoForm').valid && pagamentiForm.get('prezzoForm').touched">
                  Inserire un numero con virgola
                </mat-error>
              </mat-form-field>
            </div>
            <div class="column">
              <mat-form-field appearance="fill">
                <mat-label>Note</mat-label>
                <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize" formControlName="noteForm"
                  cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5"></textarea>
              </mat-form-field>
            </div>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </mat-tab>
</mat-tab-group>

<br><br>
<button *ngIf="!prenotazioneEffettuata" mat-raised-button color="accent" style="float: right"
  (click)="closePrenCreate()">
  Chiudi
</button>

<button *ngIf="!prenotazioneEffettuata; else prenotazioneEffettuataMsg" mat-raised-button color="primary"
  [disabled]="!clientePren || !pagamentiForm.valid" style="float: right; margin-right: 40px"
  (click)="prenotaOmbrellone()">
  PRENOTA
</button>

<ng-template #prenotazioneEffettuataMsg>
  <mat-card class="successCard">
    <h1>
      <mat-icon>check_circle</mat-icon> Prenotazione effettuata!
    </h1>
    <button color="accent" mat-raised-button style="float: right" (click)="closePrenCreate()"> Chiudi </button>
  </mat-card>
</ng-template>
